dat = read.csv("train_resized.csv",sep=" ")
reduced = rep(NA,length(dat[1,]))
for(i in 0:9){
  datPart <- dat[dat[,1]==i,-1]
  hc <- hclust(dist(datPart), "ave")
  memb <- cutree(hc, k = 400)
  for(j in 1:400){
    reduced = rbind(reduced, as.vector(c(i, unlist((datPart[memb==j,])[1,]))))
  }
}
write(t(reduced),file="digits_resized_reduced_400.csv",ncolumns=785)







for(j in 1:10){
  im <- matrix( 1 - unlist((datPart[memb==3,])[j,])/256, nrow = 28, byrow=T)
  writePNG(im, paste("clust",j,".png",sep="")) 
}


im <- matrix( 1 - unlist((datPart[memb==3,])[1,])/256, nrow = 28, byrow=T)
?cutree
dat1=dat[dat[,1]==1,-1]
hc <- hclust(dist(dat1), "complete");
Cairo(width = 3000, height = 5000, file="clustering.png", type="png")
plot(as.dendrogram(hc),horiz=T)
dev.off()

memb <- cutree(hc, k = 50)
cent <- NULL
for(k in 1:50){
  cent <- rbind(cent, colMeans(dat1[memb == k, , drop = FALSE]))
}

# averages the images, for uses as prospect
library(png)
image=matrix(as.vector(unlist(cent[1,-1])),nrow=28,ncol=28,byrow=F)
writePNG(image, "averages.png")


train <- read.csv("../data/train.csv", header=TRUE)

labels <- as.numeric(train[,1])
train <- train[,-1]

bigify <- function(im, r){
  result <- matrix(nrow=nrow(im)*r, ncol=ncol(im)*r)
  for(i in 1:nrow(im)){
    for(j in 1:ncol(im)){
      for(k in 1:r){
        for(l in 1:r){
          result[(i - 1) * r + (k - 1) + 1, (j - 1) * r + (l - 1) + 1] <- im[i, j]
        }
      }
    }
  }
  return(result)
}

images <- list()
for(x in 0:9){
  average <- colMeans(train[labels == x,])
  im <- t(matrix(1 - average/256, nrow = 28))
  im <- bigify(im, 8)
  images[[as.character(x)]] <- im
}

row1 <- matrix(nrow=28*8)
for(i in 0:4){
  row1 <- cbind(row1, images[[as.character(i)]])
}
row1 <- row1[,-1] # kills the NA row

row2 <- matrix(nrow=28*8)
for(i in 5:9){
  row2 <- cbind(row2, images[[as.character(i)]])
}
row2 <- row2[,-1] # kills the NA row

writePNG(rbind(row1, row2), "averages.png")
#
#
#

library(reshape2)
library(ggplot2)
dat=read.csv("../digits_reduced_50.csv",sep=" ")
series_2plot = 15
im <- matrix( 1 - as.vector(unlist(dat[series_2plot,-1]))/256,nrow=28,ncol=28,byrow=F)
im2 <- matrix( 1 - as.vector(unlist(dat[series_2plot,-1]))/256,nrow=28,ncol=28,byrow=F)
ggplot(melt(cbind(im,im2)), aes(Var1,-Var2,fill=value)) + geom_raster()


writePNG(im, "digits/averages.png")


d=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 61, 118, 240, 255, 228, 105, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 66, 244, 253, 253, 174, 227, 236, 42, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 71, 237, 253, 120, 40, 8, 56, 186, 227, 39, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 12, 189, 253, 225, 5, 0, 0, 0, 22, 198, 102, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 74, 253, 244, 40, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 192, 253, 157, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 192, 253, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 75, 252, 219, 3, 0, 0, 0, 0, 81, 99, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 199, 253, 219, 0, 0, 0, 32, 128, 246, 250, 223, 46, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 213, 253, 219, 0, 36, 203, 223, 253, 253, 253, 253, 230, 48, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 213, 253, 119, 29, 154, 253, 236, 167, 68, 88, 253, 253, 169,
    7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 213, 253, 82, 151, 253, 241, 72, 0, 0, 10, 167,
    253, 253, 49, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 213, 253, 179, 209, 253, 65, 0, 0, 0,
    0, 7, 250, 253, 173, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 213, 253, 253, 246, 129, 3, 0,
    0, 0, 0, 0, 125, 253, 253, 54, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 157, 253, 253, 109, 0,
    0, 0, 0, 0, 0, 0, 125, 253, 253, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 137, 152,
    14, 0, 0, 0, 0, 0, 0, 0, 17, 242, 253, 191, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 132, 253, 191, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 104, 253, 191, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 39, 232, 196, 18, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 220, 253, 137, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0)
im <- matrix( 1 - d/256,nrow=28,ncol=28,byrow=F)
(p1=ggplot(melt(im), aes(Var1,-Var2,fill=value)) + geom_raster())

d=c(0.8079621855688683, 0.929060974066848, 0.6727682915656485, 0.37070626838932386, 0.6662144337146809, 0.2911392405063291, 0.08860759493670886, -0.014174775185418742, 0.27565892320998564, -0.16539535392599136, -0.14769984339266268, -0.31645569620253167, -0.2032905342780163, -0.27565892320998564, 0.1653953539259914, 0.7614690763932829, 1.0, 0.929060974066848, 0.4677675811188185, 0.4677675811188185, 0.929060974066848, 1.0, 1.0, 0.6727682915656485, 0.6727682915656485, 1.0, 0.8930108366813808, 0.6400326547015383, 0.2557107127473839, -0.2353631690670147, -0.4102773427573963, -0.2698412698412698, -0.34612230745149225, 0.11933166594877914, 0.37745515533680457, 0.6400326547015383, 0.8930108366813808, 0.6727682915656485, 0.37070626838932386, 0.626422431982715, 0.30310762837873306, -0.14769984339266268, -0.31645569620253167, -0.2698412698412698, 0.18338688097178613, 0.3394221166510653, 0.48936170212765956)
im <- data.frame(x=seq(1:length(d)),y=d)
(p2=ggplot(im, aes(x,y)) + geom_line())
